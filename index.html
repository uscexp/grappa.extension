<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>grappa.extension by uscexp</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>grappa.extension</h1>
        <p>AST interpreter extension for parboiled/grappa parser.</p>

        <p class="view"><a href="https://github.com/uscexp/grappa.extension">View the Project on GitHub <small>uscexp/grappa.extension</small></a></p>


        <ul>
          <li><a href="https://github.com/uscexp/grappa.extension/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/uscexp/grappa.extension/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/uscexp/grappa.extension">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="grappaextension" class="anchor" href="#grappaextension"><span class="octicon octicon-link"></span></a>grappa.extension</h1>

<h2>
<a name="introduction" class="anchor" href="#introduction"><span class="octicon octicon-link"></span></a>Introduction</h2>

<p>AST interpreter extension for <a href="https://github.com/sirthias/parboiled">parboiled</a>/<a href="https://github.com/parboiled1/grappa">grappa</a> parser.</p>

<h2>
<a name="news" class="anchor" href="#news"><span class="octicon octicon-link"></span></a>News</h2>

<p>21.Aug.2014: New release <a href="https://github.com/uscexp/grappa.extension/releases/tag/v0.2.0-Beta">v0.2.0-Beta</a> which adds an AST commands java source code generator.</p>

<p>15.Aug.2014: First release <a href="https://github.com/uscexp/grappa.extension/releases/tag/v0.1.0-Beta">v0.1.0-Beta</a> which adds the AST interpreter.</p>

<h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>AST java source code generator for the AST command tree node classes.</li>
<li>AST interpreter creates an AST (Abstract Syntax Tree) structure.</li>
<li>The interpreter iterates over the AST structure and executes the implemented logic.</li>
</ul><h2>
<a name="description" class="anchor" href="#description"><span class="octicon octicon-link"></span></a>Description</h2>

<p>The <code>AstInterpreter</code> interpretes a PEG defined language based on a <a href="https://github.com/parboiled1/grappa">grappa</a> <code>BaseParser</code>.
First it creates an AST (Abstract Syntax Tree) based on the <a href="https://github.com/parboiled1/grappa">grappa</a> <code>ParsingResult</code> and
the annotated parser methods, annotated with <code>@AstValue</code> or <code>@AstCommand</code>.
<code>@AstValue</code> writes the parse node value to the interpreter stack. By default the interpreter stores the values as in the parser defined type, if one wants to change that, one has to define the corresponding parameters of the <code>@AstValue</code> annotation.
<code>@AstCommand</code> must be implemented from a developer, which has to create the <code>Ast&lt;Name&gt;TreeNode</code> and implement it. This represents the logic of your language commands. The <code>AstCommandTreeNode</code> classes by default are located in the same package as the parser implementation and have the naming convetion of Ast + name of your parser rule (first char upper case) + TreeNode and must extend <code>AstCommandTreeNode</code>. If one want to change that, one has to define the corresponding parameters of the <code>@AstCommand</code> annotation.</p>

<p>The <code>AstModelGenerator</code> creates the model classes from a <a href="https://github.com/parboiled1/grappa">grappa</a> <code>BaseParser</code> extended and annotated parser class. It creates the corresponding java source files for the <code>@AstCommand</code> annotated rules in the parser class. The generated classes will extend <code>AstCommandTreeNode</code> and the to be implemented method <code>interpret</code>.</p>

<h2>
<a name="example" class="anchor" href="#example"><span class="octicon octicon-link"></span></a>Example</h2>

<div class="highlight highlight-java"><pre><span class="o">...</span>
<span class="n">String</span> <span class="n">input</span> <span class="o">=</span> <span class="s">"2 * 2 + 2 * 3"</span><span class="o">;</span>
<span class="n">CalculatorParser</span> <span class="n">calculatorParser</span> <span class="o">=</span> <span class="n">Parboiled</span><span class="o">.</span><span class="na">createParser</span><span class="o">(</span><span class="n">CalculatorParser</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="n">RecoveringParseRunner</span><span class="o">&lt;</span><span class="n">CalculatorParser</span><span class="o">&gt;</span> <span class="n">recoveringParseRunner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RecoveringParseRunner</span><span class="o">&lt;&gt;(</span><span class="n">calculatorParser</span><span class="o">.</span><span class="na">inputLine</span><span class="o">());</span>

<span class="n">ParsingResult</span><span class="o">&lt;</span><span class="n">CalculatorParser</span><span class="o">&gt;</span> <span class="n">parsingResult</span> <span class="o">=</span> <span class="n">recoveringParseRunner</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>

<span class="n">Node</span><span class="o">&lt;</span><span class="n">CalculatorParser</span><span class="o">&gt;</span> <span class="n">root</span> <span class="o">=</span> <span class="n">parsingResult</span><span class="o">.</span><span class="na">parseTreeRoot</span><span class="o">;</span>
<span class="n">AstInterpreter</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">interpreter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AstInterpreter</span><span class="o">&lt;&gt;();</span>
<span class="n">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">();</span>
<span class="n">interpreter</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">calculatorParser</span><span class="o">.</span><span class="na">getClass</span><span class="o">(),</span> <span class="n">parsingResult</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
<span class="n">interpreter</span><span class="o">.</span><span class="na">cleanUp</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="o">...</span>
</pre></div>

<p>First it creates an instance of <code>CalculatorParser</code> with the grappa factory method. Then one need a <code>ParseRunner</code> and run it with the input string. This gives us the <code>ParsingResult</code> which we need for the parse tree root. Up to now we have only treated with the <a href="https://github.com/sirthias/parboiled">parboiled</a>/<a href="https://github.com/parboiled1/grappa">grappa</a> parser.
Now to the point. We create an <code>AstInterpreter</code> and call the <code>execute</code> method with the parameters calculation parser class, parsing result and an id. This will create the AST structure and interpret it.
Finally clean up the interpreter (remove process store like stack ...).</p>

<p>For the java source code model generation use: <code>java -cp &lt;dependencies&gt; com.github.uscexp.grappa.extension.codegenerator.AstModelGenerator pasrserClass sourceOutputPath</code>.
e.g. <code>java -cp grappa.jar;asm-debug-all.jar;guava.jar;codemodel.jar;grappa.extension.jar;MyParserLib.jar; com.github.uscexp.grappa.extension.codegenerator.AstModelGenerator com.github.uscexp.grappa.parcer.CalculatorParser src/main/java</code></p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>To use the library in your java project just put the binary jar file to your classpath.
The maven dependency can be found here: <a href="http://mvnrepository.com/artifact/com.github.uscexp/grappa.extension">mvnrepository</a></p>

<p>(C) 2014 by haui</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/uscexp">uscexp</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>